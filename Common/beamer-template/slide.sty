\usepackage{amsmath, latexsym, amssymb, mathtools, bm, ascmac, multicol, multirow, tcolorbox, subfig, url, tikz, graphicx, wrapfig, lipsum, pgfpages, csquotes, ifplatform}
\usepackage[style=numeric,backend=biber,sorting=none]{biblatex}
\usepackage[absolute,overlay]{textpos}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}

% color
\newcommand{\red}[1]{\textcolor{red}{#1}}
\newcommand{\green}[1]{\textcolor{green!80!black}{#1}}
\newcommand{\blue}[1]{\textcolor{blue!80!black}{#1}}

\definecolor{gray}{HTML}{373b41}
\definecolor{black}{HTML}{282a2e}
\definecolor{red}{HTML}{a54242}
\definecolor{yellow}{HTML}{8c9440}
\definecolor{blue}{HTML}{5f819d}
\definecolor{orange}{HTML}{de935f}
\definecolor{green}{HTML}{8c9440}

\usepackage{listings}
\lstdefinelanguage{Kotlin}{
  comment=[l]{//},
  commentstyle={\color{gray}\ttfamily},
  emph={filter, first, firstOrNull, forEach, lazy, map, mapNotNull, println},
  emphstyle={\color{red}},
  identifierstyle=\color{black},
  keywords={!in, !is, abstract, actual, annotation, as, as?, break, by, catch, class, companion, const, constructor, continue, crossinline, data, delegate, do, dynamic, else, enum, expect, external, false, field, file, final, finally, for, fun, get, if, import, in, infix, init, inline, inner, interface, internal, is, lateinit, noinline, null, object, open, operator, out, override, package, param, private, property, protected, public, receiveris, reified, return, return@, sealed, set, setparam, super, suspend, tailrec, this, throw, true, try, typealias, typeof, val, var, vararg, when, where, while},
  keywordstyle={\color{blue}\bfseries},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
  morestring=[s]{"""*}{*"""},
  ndkeywords={@Deprecated, @JvmField, @JvmName, @JvmOverloads, @JvmStatic, @JvmSynthetic, Array, Byte, Double, Float, Int, Integer, Iterable, Long, Runnable, Short, String, Any, Unit, Nothing},
  ndkeywordstyle={\color{orange}\bfseries},
  sensitive=true,
  stringstyle={\color{green}\ttfamily},
}
\lstset{
  basicstyle=\ttfamily\footnotesize,
  frame=tRBl,
  framesep=5pt,
  numbers=left,
  stepnumber=1,
  numberstyle=\footnotesize,
  tabsize=2,
  classoffset=1,
  breaklines=true
}
\lstset{literate=%
   *{0}{{{\color{red!20!violet}0}}}1
    {1}{{{\color{red!20!violet}1}}}1
    {2}{{{\color{red!20!violet}2}}}1
    {3}{{{\color{red!20!violet}3}}}1
    {4}{{{\color{red!20!violet}4}}}1
    {5}{{{\color{red!20!violet}5}}}1
    {6}{{{\color{red!20!violet}6}}}1
    {7}{{{\color{red!20!violet}7}}}1
    {8}{{{\color{red!20!violet}8}}}1
    {9}{{{\color{red!20!violet}9}}}1
}

\usetheme{metropolis}
\metroset{numbering=counter,sectionpage=simple,subsectionpage=none}
\setbeamercolor{normal text}{fg=black}
\setbeamercolor{frametitle}{bg=normal text.bg,fg=normal text.fg}
\setbeamercolor{title separator}{fg=gray}
\setbeamercolor{footnote}{use=palette primary}
\setbeamercolor{progress bar in section page}{use=progress bar,parent=progress bar,fg=gray}
\setbeamertemplate{itemize items}[square]
\setbeamertemplate{itemize subitem}[triangle]

\setbeamertemplate{footline}{
  \begin{beamercolorbox}[wd=\textwidth,sep=1.5ex]{footline}
        \usebeamerfont{page number in head/foot}
        \usebeamertemplate*{frame footer}
        \hfill
        \usebeamertemplate*{frame numbering}
    \end{beamercolorbox}
}

%\setbeameroption{show notes on second screen}

%ハイパーリンク
\usepackage{bxdpx-beamer}

%フォントの設定
\usepackage[no-math]{fontspec}
%ラテン文字のフォントをIBM plexに
\usepackage[T1]{fontenc}
\usepackage[usefilenames,DefaultFeatures={Ligatures=Common}]{plex-otf}
%日本語フォント
\usepackage[UTF-8]{luatexja-fontspec}
\iflinux
\setmainjfont[
    FontFace = {l}{\updefault}{* Medium},
    UprightFont = {* Regular}, % for \mdseries
    BoldFont = {* Bold},       % for \bfseries
    FontFace = {eb}{\updefault}{* Heavy},
    AutoFakeSlant = 0.25,
    YokoFeatures={JFM=prop} %JFMを指定する
]{Source Han Sans JP}
%\emojiで絵文字も扱えるように
\font\emoji={name:Noto Color Emoji:mode=harf;+ccmp;+dist}
\fi
\ifmacosx
\setmainjfont[
    FontFace = {l}{\updefault}{* W3},
    UprightFont = {* W3}, % for \mdseries
    BoldFont = {* W6},       % for \bfseries
    FontFace = {eb}{\updefault}{* W6},
    AutoFakeSlant = 0.25,
    YokoFeatures={JFM=prop} %JFMを指定する
]{Hiragino Kaku Gothic ProN}
%\emojiで絵文字も扱えるように
\font\emoji={name:Apple Color Emoji:mode=harf;+ccmp;+dist}
\fi
%数式フォントなどを上書き
\usefonttheme{professionalfonts}

%図番号
\renewcommand{\figurename}{図}
\renewcommand{\tablename}{表}
\setbeamertemplate{caption}[numbered]

%番号なしのfootnote
\newcommand\blfootnote[1]{
    \begingroup
    \renewcommand\thefootnote{}\footnote{#1}
    \addtocounter{footnote}{-1}
    \endgroup
}

\newcommand{\highlight}[2][yellow]{\tikz[baseline=(x.base)]{\node[rectangle,rounded corners,fill=#1!30](x){#2};}}
\newcommand{\highlightcap}[3][yellow]{\tikz[baseline=(x.base)]{\node[rectangle,rounded corners,fill=#1!30](x){#2} node[below of=x, color=#1]{#3};}}

%著者付きのquote
\def\signed #1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip1em
  \hbox{}\nobreak\hfill #1%
  \parfillskip=0pt \finalhyphendemerits=0 \endgraf}}

\newsavebox\mybox
\newenvironment{aquote}[1]
  {\savebox\mybox{#1}\begin{quote}\openautoquote}
  {\unskip\closeautoquote\\\vspace*{1mm}\signed{\usebox\mybox}\end{quote}}
